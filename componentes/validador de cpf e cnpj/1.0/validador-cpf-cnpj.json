{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"49f0edab-b157-4b98-aed4-e47d5283650f","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"onboarding","root":true,"$position":{"top":"110px","left":"837px"},"$title":"Início","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ffa7c8a0-af99-4661-86ff-f4c58aecd75a","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[],"id":"fallback","$position":{"top":"108.667px","left":"1088px"},"$title":"Exceções","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"95f50b93-628a-4c84-b149-bee4b8ae90fd":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"441316f4-08b5-4f9c-959b-17ed9c201cb2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"441316f4-08b5-4f9c-959b-17ed9c201cb2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"93b1a6a3-355f-4ad1-bb74-adae5723acf4","type":"text/plain","content":"Por favor, digite seu *CPF* (em caso de pessoa física) ou *CNPJ* (em caso de pessoa jurídica)","metadata":{}},"$cardContent":{"document":{"id":"93b1a6a3-355f-4ad1-bb74-adae5723acf4","type":"text/plain","content":"Por favor, digite seu *CPF* (em caso de pessoa física) ou *CNPJ* (em caso de pessoa jurídica)"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"99cc50e9-ab14-4958-9eb2-fd489c611cac","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7083b167-a651-4feb-a428-f705f3281f13","$connId":"con_3","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Track \"Solicita cpf\"","$invalid":false,"settings":{"extras":{},"category":"Solicita cpf","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"TrackEvent","$title":"Track \"Input cpf\"","$invalid":false,"settings":{"extras":{},"category":"Input cpf","action":"{{input.content}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"95f50b93-628a-4c84-b149-bee4b8ae90fd","root":false,"$title":"X.X.X Solicita CPF e CNPJ","$position":{"top":"222.333px","left":"835.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7083b167-a651-4feb-a428-f705f3281f13":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0bcff8ff-34a9-4022-8b5a-b33557319ef7","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1b97c5ca-49b4-4ea8-80ce-f02f9e6efbad","$connId":"con_8","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"isValidCpf@result"}],"$invalid":false},{"stateId":"1908ca82-d9cd-4696-b111-8123aa00beff","$connId":"con_13","conditions":[{"source":"context","comparison":"equals","values":["input inesperado"],"variable":"isValidCpf@result"}],"$invalid":false}],"$enteringCustomActions":[{"type":"SetVariable","$title":"Set \"input\" to \"{{input.content}}\"","$invalid":false,"settings":{"variable":"input","value":"{{input.content}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Registro de eventos","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n  result = \"cnpj valido\";\n  input = input.replace(/[^\\d]+/g,'');\n\n  if(input === '') result = \"input inesperado\";\n   \n  if (input.length !== 14) result = \"input inesperado\";\n\n  // Elimina CNPJs invalidos conhecidos\n  if (input === \"00000000000000\" || \n    input === \"11111111111111\" || \n    input === \"22222222222222\" || \n    input === \"33333333333333\" || \n    input === \"44444444444444\" || \n    input === \"55555555555555\" || \n    input === \"66666666666666\" || \n    input === \"77777777777777\" || \n    input === \"88888888888888\" || \n    input === \"99999999999999\")\n    result = \"input inesperado\";\n       \n  // Valida DVs\n  tamanho = input.length - 2\n  numeros = input.substring(0,tamanho);\n  digitos = input.substring(tamanho);\n  soma = 0;\n  pos = tamanho - 7;\n  for (i = tamanho; i >= 1; i--) {\n    soma += numeros.charAt(tamanho - i) * pos--;\n    if (pos < 2)\n      pos = 9;\n  }\n  resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;\n  if (resultado != digitos.charAt(0)) result = \"input inesperado\";\n       \n  tamanho = tamanho + 1;\n  numeros = input.substring(0,tamanho);\n  soma = 0;\n  pos = tamanho - 7;\n  for (i = tamanho; i >= 1; i--) {\n    soma += numeros.charAt(tamanho - i) * pos--;\n    if (pos < 2)\n      pos = 9;\n  }\n  resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;\n  if (resultado != digitos.charAt(1)) result = \"input inesperado\";\n\n  if (result === \"cnpj valido\") {\n    obj = {\n      'result': result,\n      'input': input\n    }\n    return obj\n  }\n\n  result = \"cpf valido\";\n\n  var Soma = 0;\n  var Resto;\n  input = input.replace(/[^0-9]/ig, \"\");\n\n  if(input.length !== 11) result = \"input inesperado\";\n\n  if(input == 1 || input == 11111111111 || input == 22222222222 || input == 33333333333 || input == 44444444444 || input == 55555555555 || input == 66666666666 || input == 77777777777 || input == 88888888888 || input == 99999999999) result = \"input inesperado\"\n     \n  for (i=1; i<=9; i++) Soma = Soma + parseInt(input.substring(i-1, i)) * (11 - i);\n    Resto = (Soma * 10) % 11;\n   \n    if ((Resto == 10) || (Resto == 11))  Resto = 0;\n    if (Resto != parseInt(input.substring(9, 10)) ) result = \"input inesperado\";\n   \n    Soma = 0;\n    for (i = 1; i <= 10; i++) Soma = Soma + parseInt(input.substring(i-1, i)) * (12 - i);\n    Resto = (Soma * 10) % 11;\n   \n    if ((Resto == 10) || (Resto == 11))  Resto = 0;\n    if (Resto != parseInt(input.substring(10, 11) ) ) result = \"input inesperado\";\n    \n    obj = {\n      'result': result,\n      'input': input\n    }\n    return obj\n}","inputVariables":["input"],"outputVariable":"isValidCpf"},"conditions":[]},{"type":"MergeContact","$title":"Set extras, name to contact","$invalid":false,"settings":{"extras":{"cpf":"{{isValidCpf@input}}"},"name":"{{contact.name}}"},"conditions":[{"source":"context","comparison":"equals","variable":"isValidCpf@result","values":["cpf valido"]}]},{"type":"MergeContact","$title":"Set extras, name to contact","$invalid":false,"settings":{"extras":{"cnpj":"{{isValidCpf@input}}"},"name":"{{contact.name}}"},"conditions":[{"source":"context","comparison":"equals","variable":"isValidCpf@result","values":["cnpj valido"]}]},{"type":"TrackEvent","$title":"Track \"Cpf valido\"","$invalid":false,"settings":{"extras":{},"category":"Cpf valido","action":"sim"},"conditions":[{"source":"context","variable":"isValidCpf@result","values":["input inesperado"],"comparison":"notEquals"}]},{"type":"TrackEvent","$title":"Track \"Cpf valido conhecer\"","$invalid":false,"settings":{"extras":{},"category":"Cpf valido conhecer","action":"nao"},"conditions":[{"source":"context","variable":"isValidCpf@result","comparison":"equals","values":["input inesperado"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"7083b167-a651-4feb-a428-f705f3281f13","root":false,"$title":"X.X.X  Valida CPF e CNPJ","$position":{"top":"365.333px","left":"835.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b78df878-ffce-45d8-9580-7494192ee964":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"9b5e9dd5-f11e-4053-a8d6-f3ce0ba9bffd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9b5e9dd5-f11e-4053-a8d6-f3ce0ba9bffd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:46995"},{"action":{"type":"SendMessage","settings":{"id":"4e079238-7637-421b-8947-40fecefccc3b","type":"text/plain","content":"Ops... não entendi. Eu realmente preciso do seu *CPF* ou *CNPJ* para que possamos continuar e eu te apresentar uma proposta personalizada no final da nossa conversa. \n\nPor favor, *digite seu CPF* ou *CNPJ* somente com números"},"$cardContent":{"document":{"id":"4e079238-7637-421b-8947-40fecefccc3b","type":"text/plain","content":"Ops... não entendi. Eu realmente preciso do seu *CPF* ou *CNPJ* para que possamos continuar e eu te apresentar uma proposta personalizada no final da nossa conversa. \n\nPor favor, *digite seu CPF* ou *CNPJ* somente com números"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:46996"},{"input":{"bypass":false,"$cardContent":{"document":{"id":"42fcc519-91c7-4079-81eb-83c628d76da9","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:46997"}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Track \"Cpf invalido\"","$invalid":false,"settings":{"extras":{},"category":"Cpf invalido","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"TrackEvent","$title":"Track \"Input cpf segunda tentativa\"","$invalid":false,"settings":{"extras":{"idUser":"{{contact.identity}}","idMessage":"{{input.message.id}}","origem":"{{origem}}","nome":"{{contact.name}}","telefone":"{{contact.phoneNumber}}","email":"{{contact.email}}","testeAB":"{{AB}}","concessionaria":"{{dealer}}","doc":"{{doc}}","entryPoint":"{{entryPoint}}","veiculo":"{{veiculo}}"},"category":"Input cpf segunda tentativa","action":"{{input.content}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7083b167-a651-4feb-a428-f705f3281f13","$invalid":false},"$tags":[],"id":"b78df878-ffce-45d8-9580-7494192ee964","root":false,"$title":"X.X.X  Digita CPF e CNPJ Novamente","$position":{"top":"927.667px","left":"1476.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"12b4d81b-77ff-4a65-8463-f86ba2472347":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"1c92e8a1-0a7c-4ebc-81e2-ac1dc4a93016","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"12b4d81b-77ff-4a65-8463-f86ba2472347","root":false,"$title":"X.X.X Erro proximo de CPF ou CNPJ","$position":{"top":"798.667px","left":"1014.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1b97c5ca-49b4-4ea8-80ce-f02f9e6efbad":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b22a6f6e-dfdf-4aee-a422-dc6455c945ef","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"1b97c5ca-49b4-4ea8-80ce-f02f9e6efbad","root":false,"$title":"X.X.X Documento valido","$position":{"top":"511.667px","left":"671px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5d0f19bb-5751-466f-b1f9-f58905db8566":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"43006a98-728f-49ad-82a9-17cee2bb6aa0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8dc3ab32-960c-492f-b76e-eaa4cc8a761d","$connId":"con_18","conditions":[{"source":"context","comparison":"equals","values":["sim"],"variable":"isPalavraChave"}],"$invalid":false},{"stateId":"b78df878-ffce-45d8-9580-7494192ee964","$connId":"con_23","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"isPalavraChave"}],"$invalid":false}],"$enteringCustomActions":[{"type":"SetVariable","$title":"Set \"isPalavraChave\" to \"undefined\"","$invalid":false,"settings":{"variable":"isPalavraChave"},"conditions":[]},{"type":"SetVariable","$title":"Set \"isPalavraChave\" to \"sim\"","$invalid":false,"settings":{"variable":"isPalavraChave","value":"sim"},"conditions":[{"source":"input","comparison":"approximateTo","values":["Menu","Voltar menu","Voltar ao menu","Voltar","Sair","Encerrar","Parar","Não quero mais","Falar com atendente","Chamar atendente","Falar com alguém","Falar com uma pessoa","Não quero falar com robô"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"5d0f19bb-5751-466f-b1f9-f58905db8566","root":false,"$title":"X.X.X Verifica palavra chave","$position":{"top":"803.667px","left":"1320.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8c82dc76-6631-47d3-84d3-90ed461e1a93":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"aa63d88b-55af-4243-8895-5dd658226c31","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"aa63d88b-55af-4243-8895-5dd658226c31","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"a5a2ed79-66e4-4253-933e-f5a5a73a828e","type":"text/plain","content":"😕 Ainda não consegui entender...\nNesse caso, vou te transferir para um atendente."},"$cardContent":{"document":{"id":"a5a2ed79-66e4-4253-933e-f5a5a73a828e","type":"text/plain","content":"😕 Ainda não consegui entender...\nNesse caso, vou te transferir para um atendente."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"64e9519e-7d9a-4f72-b194-7a6265d6c1ff","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"SetVariable","$title":"Set \"cpfTry\" to \"undefined\"","$invalid":false,"settings":{"variable":"cpfTry"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"8c82dc76-6631-47d3-84d3-90ed461e1a93","root":false,"$title":"X.X.X  Encaminha Atendimento","$position":{"top":"657.667px","left":"836.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1908ca82-d9cd-4696-b111-8123aa00beff":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"78d3a1ca-6b2d-47f4-a4cc-9ec1469b6e28","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8c82dc76-6631-47d3-84d3-90ed461e1a93","$connId":"con_28","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"cpfTryCount"}],"$invalid":false},{"stateId":"a72e564a-04ac-458e-9837-9e63fae31442","$connId":"con_33","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"type":"SetVariable","$title":"Set \"cpfTryCount\" to \"2\"","$invalid":false,"settings":{"variable":"cpfTryCount","value":"2"},"conditions":[{"source":"context","comparison":"equals","variable":"cpfTryCount","values":["1"]}]},{"type":"SetVariable","$title":"Set \"cpfTryCount\" to \"1\"","$invalid":false,"settings":{"variable":"cpfTryCount","value":"1"},"conditions":[{"source":"context","comparison":"notEquals","variable":"cpfTryCount","values":["2"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"1908ca82-d9cd-4696-b111-8123aa00beff","root":false,"$title":"X.X.X Contagem Tentativas","$position":{"top":"511px","left":"993.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a72e564a-04ac-458e-9837-9e63fae31442":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"26b1fed0-a4a6-4c03-a271-70e6d0b90563","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"12b4d81b-77ff-4a65-8463-f86ba2472347","$connId":"con_38","conditions":[{"source":"context","comparison":"equals","values":["sim"],"variable":"isProxToDoc@result"}],"$invalid":false},{"stateId":"5d0f19bb-5751-466f-b1f9-f58905db8566","$connId":"con_43","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Process \"isProxToDoc\"","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n  input = input.replace(/[^\\d]+/g,'');\n  result = input.length >= 9 && input.length <= 12 ? {\"result\": \"sim\", \"type\": \"CPF\"} :\n   input.length >= 13 && input.length <= 16 ? {\"result\": \"sim\", \"type\": \"CNPJ\"} :\n   {\"result\": \"nao\", \"type\": \"NULL\"}\n  return result\n}","inputVariables":["input"],"outputVariable":"isProxToDoc"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"a72e564a-04ac-458e-9837-9e63fae31442","root":false,"$title":"X.X.X Input proximo de CPF ou CNPJ","$position":{"top":"664.667px","left":"1169.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8dc3ab32-960c-492f-b76e-eaa4cc8a761d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d03a1841-8bb2-40d3-b178-39d7640719ac","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"8dc3ab32-960c-492f-b76e-eaa4cc8a761d","root":false,"$title":"X.X.X Encaminha Palavra Chave","$position":{"top":"927.667px","left":"1176.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}